<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: make-fetch-happen</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_backend_2node__modules_2make-fetch-happen_2_r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">make-fetch-happen</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1809"></a><a href="https://npm.im/make-fetch-happen"><img src="https://img.shields.io/npm/v/make-fetch-happen.svg" alt="npm version" style="pointer-events: none;" class="inline"/></a> <a href="https://npm.im/make-fetch-happen"><img src="https://img.shields.io/npm/l/make-fetch-happen.svg" alt="license" style="pointer-events: none;" class="inline"/></a> <a href="https://travis-ci.org/npm/make-fetch-happen"><img src="https://img.shields.io/travis/npm/make-fetch-happen.svg" alt="Travis" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/github/npm/make-fetch-happen?branch=latest"><img src="https://coveralls.io/repos/github/npm/make-fetch-happen/badge.svg?branch=latest" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://github.com/npm/make-fetch-happen"><code>make-fetch-happen</code></a> is a Node.js library that wraps <a href="https://github.com/npm/minipass-fetch"><code>minipass-fetch</code></a> with additional features <a href="https://github.com/npm/minipass-fetch"><code>minipass-fetch</code></a> doesn't intend to include, including HTTP Cache support, request pooling, proxies, retries, and more!</p>
<h1><a class="anchor" id="autotoc_md1810"></a>
Install</h1>
<p><code>$ npm install --save make-fetch-happen</code></p>
<h1><a class="anchor" id="autotoc_md1811"></a>
Table of Contents</h1>
<ul>
<li>Example</li>
<li>Features</li>
<li>Contributing</li>
<li><a class="el" href="md_backend_2node__modules_2node-addon-api_2_r_e_a_d_m_e.html#api">API</a><ul>
<li>`fetch`</li>
<li>`fetch.defaults`</li>
<li>`minipass-fetch` options</li>
<li>`make-fetch-happen` options<ul>
<li>`opts.cachePath`</li>
<li>`opts.cache`</li>
<li>`opts.proxy`</li>
<li>`opts.noProxy`</li>
<li>`opts.ca, opts.cert, opts.key`</li>
<li>`opts.maxSockets`</li>
<li>`opts.retry`</li>
<li>`opts.onRetry`</li>
<li>`opts.integrity`</li>
</ul>
</li>
</ul>
</li>
<li>Message From Our Sponsors</li>
</ul>
<h2><a class="anchor" id="autotoc_md1812"></a>
Example</h2>
<div class="fragment"><div class="line">const fetch = require(&#39;make-fetch-happen&#39;).defaults({</div>
<div class="line">  cachePath: &#39;./my-cache&#39; // path where cache will be written (and read)</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;).then(res =&gt; {</div>
<div class="line">  return res.json() // download the body as JSON</div>
<div class="line">}).then(body =&gt; {</div>
<div class="line">  console.log(`got ${body.name} from web`)</div>
<div class="line">  return fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">    cache: &#39;no-cache&#39; // forces a conditional request</div>
<div class="line">  })</div>
<div class="line">}).then(res =&gt; {</div>
<div class="line">  console.log(res.status) // 304! cache validated!</div>
<div class="line">  return res.json().then(body =&gt; {</div>
<div class="line">    console.log(`got ${body.name} from cache`)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1813"></a>
Features</h2>
<ul>
<li>Builds around <a href="https://npm.im/minipass-fetch"><code>minipass-fetch</code></a> for the core <a href="https://fetch.spec.whatwg.org"><code>fetch</code> API</a> implementation</li>
<li>Request pooling out of the box</li>
<li>Quite fast, really</li>
<li>Automatic HTTP-semantics-aware request retries</li>
<li>Cache-fallback automatic "offline mode"</li>
<li>Proxy support (http, https, socks, socks4, socks5)</li>
<li>Built-in request caching following full HTTP caching rules (<code>Cache-Control</code>, <code>ETag</code>, <code>304</code>s, cache fallback on error, etc).</li>
<li>Customize cache storage with any <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">Cache API</a>-compliant <code>Cache</code> instance. Cache to Redis!</li>
<li>Node.js Stream support</li>
<li>Transparent gzip and deflate support</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">Subresource Integrity</a> support</li>
<li>Literally punches nazis</li>
<li>(PENDING) Range request caching and resuming</li>
</ul>
<h2><a class="anchor" id="autotoc_md1814"></a>
Contributing</h2>
<p>The make-fetch-happen team enthusiastically welcomes contributions and project participation! There's a bunch of things you can do if you want to contribute! The <a href="https://github.com/npm/cli/blob/latest/CONTRIBUTING.md">Contributor Guide</a> outlines the process for community interaction and contribution. Please don't hesitate to jump in if you'd like to, or even ask us questions if something isn't clear.</p>
<p>All participants and maintainers in this project are expected to follow the <a href="https://www.npmjs.com/policies/conduct">npm Code of Conduct</a>, and just generally be excellent to each other.</p>
<p>Please refer to the <a class="el" href="which_2_c_h_a_n_g_e_l_o_g_8md.html">Changelog</a> for project history details, too.</p>
<p>Happy hacking!</p>
<h2><a class="anchor" id="autotoc_md1815"></a>
API</h2>
<h3><a class="anchor" id="autotoc_md1816"></a>
<a class="anchor" id="fetch"></a> <code>&gt; fetch(uriOrRequest, [opts]) -&gt; Promise&lt;Response&gt;</code></h3>
<p>This function implements most of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"><code>fetch</code> API</a>: given a <code>uri</code> string or a <code>Request</code> instance, it will fire off an http request and return a Promise containing the relevant response.</p>
<p>If <code>opts</code> is provided, the `minipass-fetch`-specific options will be passed to that library. There are also additional options specific to make-fetch-happen that add various features, such as HTTP caching, integrity verification, proxy support, and more.</p>
<h4><a class="anchor" id="autotoc_md1817"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://google.com&#39;).then(res =&gt; res.buffer())</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1818"></a>
<a class="anchor" id="fetch-defaults"></a> <code>&gt; fetch.defaults([defaultUrl], [defaultOpts])</code></h3>
<p>Returns a new <code>fetch</code> function that will call <code>make-fetch-happen</code> using <code>defaultUrl</code> and <code>defaultOpts</code> as default values to any calls.</p>
<p>A defaulted <code>fetch</code> will also have a <code>.defaults()</code> method, so they can be chained.</p>
<h4><a class="anchor" id="autotoc_md1819"></a>
Example</h4>
<div class="fragment"><div class="line">const fetch = require(&#39;make-fetch-happen&#39;).defaults({</div>
<div class="line">  cachePath: &#39;./my-local-cache&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;) // will always use the cache</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1820"></a>
<a class="anchor" id="minipass-fetch-options"></a> <code>&gt; minipass-fetch options</code></h3>
<p>The following options for <code>minipass-fetch</code> are used as-is:</p>
<ul>
<li>method</li>
<li>body</li>
<li>redirect</li>
<li>follow</li>
<li>timeout</li>
<li>compress</li>
<li>size</li>
</ul>
<p>These other options are modified or augmented by make-fetch-happen:</p>
<ul>
<li>headers - Default <code>User-Agent</code> set to make-fetch happen. <code>Connection</code> is set to <code>keep-alive</code> or <code>close</code> automatically depending on <code>opts.agent</code>.</li>
<li>agent<ul>
<li>If agent is null, an http or https Agent will be automatically used. By default, these will be <code>http.globalAgent</code> and <code>https.globalAgent</code>.</li>
<li>If `opts.proxy` is provided and <code>opts.agent</code> is null, the agent will be set to an appropriate proxy-handling agent.</li>
<li>If <code>opts.agent</code> is an object, it will be used as the request-pooling agent argument for this request.</li>
<li>If <code>opts.agent</code> is <code>false</code>, it will be passed as-is to the underlying request library. This causes a new Agent to be spawned for every request.</li>
</ul>
</li>
</ul>
<p>For more details, see <a href="https://github.com/npm/minipass-fetch#options">the documentation for <code>minipass-fetch</code> itself</a>.</p>
<h3><a class="anchor" id="autotoc_md1821"></a>
<a class="anchor" id="extra-options"></a> <code>&gt; make-fetch-happen options</code></h3>
<p>make-fetch-happen augments the <code>minipass-fetch</code> API with additional features available through extra options. The following extra options are available:</p>
<ul>
<li>`opts.cachePath` - Cache target to read/write</li>
<li>`opts.cache` - <code>fetch</code> cache mode. Controls cache <em>behavior</em>.</li>
<li>`opts.proxy` - Proxy agent</li>
<li>`opts.noProxy` - Domain segments to disable proxying for.</li>
<li>`opts.ca, opts.cert, opts.key, opts.strictSSL`</li>
<li>`opts.localAddress`</li>
<li>`opts.maxSockets`</li>
<li>`opts.retry` - Request retry settings</li>
<li>`opts.onRetry` - a function called whenever a retry is attempted</li>
<li>`opts.integrity` - <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">Subresource Integrity</a> metadata.</li>
</ul>
<h3><a class="anchor" id="autotoc_md1822"></a>
<a class="anchor" id="opts-cache-path"></a> <code>&gt; opts.cachePath</code></h3>
<p>A string <code>Path</code> to be used as the cache root for <a href="https://npm.im/cacache"><code>cacache</code></a>.</p>
<p><b>NOTE</b>: Requests will not be cached unless their response bodies are consumed. You will need to use one of the <code>res.json()</code>, <code>res.buffer()</code>, etc methods on the response, or drain the <code>res.body</code> stream, in order for it to be written.</p>
<p>The default cache manager also adds the following headers to cached responses:</p>
<ul>
<li><code>X-Local-Cache</code>: Path to the cache the content was found in</li>
<li><code>X-Local-Cache-Key</code>: Unique cache entry key for this response</li>
<li><code>X-Local-Cache-Mode</code>: Either <code>stream</code> or <code>buffer</code> to indicate how the response was read from cacache</li>
<li><code>X-Local-Cache-Hash</code>: Specific integrity hash for the cached entry</li>
<li><code>X-Local-Cache-Status</code>: One of <code>miss</code>, <code>hit</code>, <code>stale</code>, <code>revalidated</code>, <code>updated</code>, or <code>skip</code> to signal how the response was created</li>
<li><code>X-Local-Cache-Time</code>: UTCString of the cache insertion time for the entry</li>
</ul>
<p>Using <a href="https://npm.im/cacache"><code>cacache</code></a>, a call like this may be used to manually fetch the cached entry:</p>
<div class="fragment"><div class="line">const h = response.headers</div>
<div class="line">cacache.get(h.get(&#39;x-local-cache&#39;), h.get(&#39;x-local-cache-key&#39;))</div>
<div class="line"> </div>
<div class="line">// grab content only, directly:</div>
<div class="line">cacache.get.byDigest(h.get(&#39;x-local-cache&#39;), h.get(&#39;x-local-cache-hash&#39;))</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md1823"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  cachePath: &#39;./my-local-cache&#39;</div>
<div class="line">}) // -&gt; 200-level response will be written to disk</div>
</div><!-- fragment --><p>A possible (minimal) implementation for <code>MyCustomRedisCache</code>:</p>
<div class="fragment"><div class="line">const bluebird = require(&#39;bluebird&#39;)</div>
<div class="line">const redis = require(&quot;redis&quot;)</div>
<div class="line">bluebird.promisifyAll(redis.RedisClient.prototype)</div>
<div class="line">class MyCustomRedisCache {</div>
<div class="line">  constructor (opts) {</div>
<div class="line">    this.redis = redis.createClient(opts)</div>
<div class="line">  }</div>
<div class="line">  match (req) {</div>
<div class="line">    return this.redis.getAsync(req.url).then(res =&gt; {</div>
<div class="line">      if (res) {</div>
<div class="line">        const parsed = JSON.parse(res)</div>
<div class="line">        return new fetch.Response(parsed.body, {</div>
<div class="line">          url: req.url,</div>
<div class="line">          headers: parsed.headers,</div>
<div class="line">          status: 200</div>
<div class="line">        })</div>
<div class="line">      }</div>
<div class="line">    })</div>
<div class="line">  }</div>
<div class="line">  put (req, res) {</div>
<div class="line">    return res.buffer().then(body =&gt; {</div>
<div class="line">      return this.redis.setAsync(req.url, JSON.stringify({</div>
<div class="line">        body: body,</div>
<div class="line">        headers: res.headers.raw()</div>
<div class="line">      }))</div>
<div class="line">    }).then(() =&gt; {</div>
<div class="line">      // return the response itself</div>
<div class="line">      return res</div>
<div class="line">    })</div>
<div class="line">  }</div>
<div class="line">  &#39;delete&#39; (req) {</div>
<div class="line">    return this.redis.unlinkAsync(req.url)</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1824"></a>
<a class="anchor" id="opts-cache"></a> <code>&gt; opts.cache</code></h3>
<p>This option follows the standard <code>fetch</code> API cache option. This option will do nothing if `opts.cachePath` is null. The following values are accepted (as strings):</p>
<ul>
<li><code>default</code> - Fetch will inspect the HTTP cache on the way to the network. If there is a fresh response it will be used. If there is a stale response a conditional request will be created, and a normal request otherwise. It then updates the HTTP cache with the response. If the revalidation request fails (for example, on a 500 or if you're offline), the stale response will be returned.</li>
<li><code>no-store</code> - Fetch behaves as if there is no HTTP cache at all.</li>
<li><code>reload</code> - Fetch behaves as if there is no HTTP cache on the way to the network. Ergo, it creates a normal request and updates the HTTP cache with the response.</li>
<li><code>no-cache</code> - Fetch creates a conditional request if there is a response in the HTTP cache and a normal request otherwise. It then updates the HTTP cache with the response.</li>
<li><code>force-cache</code> - Fetch uses any response in the HTTP cache matching the request, not paying attention to staleness. If there was no response, it creates a normal request and updates the HTTP cache with the response.</li>
<li><code>only-if-cached</code> - Fetch uses any response in the HTTP cache matching the request, not paying attention to staleness. If there was no response, it returns a network error. (Can only be used when request’s mode is "same-origin". Any cached redirects will be followed assuming request’s redirect mode is "follow" and the redirects do not violate request’s mode.)</li>
</ul>
<p>(Note: option descriptions are taken from <a href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch">https://fetch.spec.whatwg.org/#http-network-or-cache-fetch</a>)</p>
<h4><a class="anchor" id="autotoc_md1825"></a>
Example</h4>
<div class="fragment"><div class="line">const fetch = require(&#39;make-fetch-happen&#39;).defaults({</div>
<div class="line">  cachePath: &#39;./my-cache&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// Will error with ENOTCACHED if we haven&#39;t already cached this url</div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  cache: &#39;only-if-cached&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// Will refresh any local content and cache the new response</div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  cache: &#39;reload&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// Will use any local data, even if stale. Otherwise, will hit network.</div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  cache: &#39;force-cache&#39;</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1826"></a>
<a class="anchor" id="opts-proxy"></a> <code>&gt; opts.proxy</code></h3>
<p>A string or <code>new url.URL()</code>-d URI to proxy through. Different Proxy handlers will be used depending on the proxy's protocol.</p>
<p>Additionally, <code>process.env.HTTP_PROXY</code>, <code>process.env.HTTPS_PROXY</code>, and <code>process.env.PROXY</code> are used if present and no <code>opts.proxy</code> value is provided.</p>
<p>(Pending) <code>process.env.NO_PROXY</code> may also be configured to skip proxying requests for all, or specific domains.</p>
<h4><a class="anchor" id="autotoc_md1827"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  proxy: &#39;https://corporate.yourcompany.proxy:4445&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen&#39;, {</div>
<div class="line">  proxy: {</div>
<div class="line">    protocol: &#39;https:&#39;,</div>
<div class="line">    hostname: &#39;corporate.yourcompany.proxy&#39;,</div>
<div class="line">    port: 4445</div>
<div class="line">  }</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1828"></a>
<a class="anchor" id="opts-no-proxy"></a> <code>&gt; opts.noProxy</code></h3>
<p>If present, should be a comma-separated string or an array of domain extensions that a proxy should <em>not</em> be used for.</p>
<p>This option may also be provided through <code>process.env.NO_PROXY</code>.</p>
<h3><a class="anchor" id="autotoc_md1829"></a>
<a class="anchor" id="https-opts"></a> <code>&gt; opts.ca, opts.cert, opts.key, opts.strictSSL</code></h3>
<p>These values are passed in directly to the HTTPS agent and will be used for both proxied and unproxied outgoing HTTPS requests. They mostly correspond to the same options the <code>https</code> module accepts, which will be themselves passed to <code>tls.connect()</code>. <code>opts.strictSSL</code> corresponds to <code>rejectUnauthorized</code>.</p>
<h3><a class="anchor" id="autotoc_md1830"></a>
<a class="anchor" id="opts-local-address"></a> <code>&gt; opts.localAddress</code></h3>
<p>Passed directly to <code>http</code> and <code>https</code> request calls. Determines the local address to bind to.</p>
<h3><a class="anchor" id="autotoc_md1831"></a>
<a class="anchor" id="opts-max-sockets"></a> <code>&gt; opts.maxSockets</code></h3>
<p>Default: 15</p>
<p>Maximum number of active concurrent sockets to use for the underlying Http/Https/Proxy agents. This setting applies once per spawned agent.</p>
<p>15 is probably a <em>pretty good value</em> for most use-cases, and balances speed with, uh, not knocking out people's routers. 🤓</p>
<h3><a class="anchor" id="autotoc_md1832"></a>
<a class="anchor" id="opts-retry"></a> <code>&gt; opts.retry</code></h3>
<p>An object that can be used to tune request retry settings. Retries will only be attempted on the following conditions:</p>
<ul>
<li>Request method is NOT <code>POST</code> AND</li>
<li>Request status is one of: <code>408</code>, <code>420</code>, <code>429</code>, or any status in the 500-range. OR</li>
<li>Request errored with <code>ECONNRESET</code>, <code>ECONNREFUSED</code>, <code>EADDRINUSE</code>, <code>ETIMEDOUT</code>, or the <code>fetch</code> error <code>request-timeout</code>.</li>
</ul>
<p>The following are worth noting as explicitly not retried:</p>
<ul>
<li><code>getaddrinfo ENOTFOUND</code> and will be assumed to be either an unreachable domain or the user will be assumed offline. If a response is cached, it will be returned immediately.</li>
</ul>
<p>If <code>opts.retry</code> is <code>false</code>, it is equivalent to <code>{retries: 0}</code></p>
<p>If <code>opts.retry</code> is a number, it is equivalent to <code>{retries: num}</code></p>
<p>The following retry options are available if you want more control over it:</p>
<ul>
<li>retries</li>
<li>factor</li>
<li>minTimeout</li>
<li>maxTimeout</li>
<li>randomize</li>
</ul>
<p>For details on what each of these do, refer to the <a href="https://npm.im/retry"><code>retry</code></a> documentation.</p>
<h4><a class="anchor" id="autotoc_md1833"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://flaky.site.com&#39;, {</div>
<div class="line">  retry: {</div>
<div class="line">    retries: 10,</div>
<div class="line">    randomize: true</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">fetch(&#39;http://reliable.site.com&#39;, {</div>
<div class="line">  retry: false</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">fetch(&#39;http://one-more.site.com&#39;, {</div>
<div class="line">  retry: 3</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1834"></a>
<a class="anchor" id="opts-onretry"></a> <code>&gt; opts.onRetry</code></h3>
<p>A function called whenever a retry is attempted.</p>
<h4><a class="anchor" id="autotoc_md1835"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://flaky.site.com&#39;, {</div>
<div class="line">  onRetry() {</div>
<div class="line">    console.log(&#39;we will retry!&#39;)</div>
<div class="line">  }</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1836"></a>
<a class="anchor" id="opts-integrity"></a> <code>&gt; opts.integrity</code></h3>
<p>Matches the response body against the given <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">Subresource Integrity</a> metadata. If verification fails, the request will fail with an <code>EINTEGRITY</code> error.</p>
<p><code>integrity</code> may either be a string or an <a href="https://npm.im/ssri"><code>ssri</code></a> <code>Integrity</code>-like.</p>
<h4><a class="anchor" id="autotoc_md1837"></a>
Example</h4>
<div class="fragment"><div class="line">fetch(&#39;https://registry.npmjs.org/make-fetch-happen/-/make-fetch-happen-1.0.0.tgz&#39;, {</div>
<div class="line">  integrity: &#39;sha1-o47j7zAYnedYFn1dF/fR9OV3z8Q=&#39;</div>
<div class="line">}) // -&gt; ok</div>
<div class="line"> </div>
<div class="line">fetch(&#39;https://malicious-registry.org/make-fetch-happen/-/make-fetch-happen-1.0.0.tgz&#39;, {</div>
<div class="line">  integrity: &#39;sha1-o47j7zAYnedYFn1dF/fR9OV3z8Q=&#39;</div>
<div class="line">}) // Error: EINTEGRITY</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1838"></a>
<a class="anchor" id="wow"></a> Message From Our Sponsors</h2>
<p><img src="stop.gif" alt="" class="inline"/></p>
<p><img src="happening.gif" alt="" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
