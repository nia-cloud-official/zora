!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(u){"use strict";var d,g,f,h,v=";",x="AS",m=u.Pos,b=u.cmpPos;function c(t){return"[object Array]"==Object.prototype.toString.call(t)}function p(t){return"string"==typeof t?t:t.text}function y(t,e){return(e=c(e)?{columns:e}:e).text||(e.text=t),e}function C(t){return d[t.toUpperCase()]}function q(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function a(t,e){var r=t.length,r=p(e).substr(0,r);return t.toUpperCase()===r.toUpperCase()}function A(t,e,r,n){if(c(r))for(var o=0;o<r.length;o++)a(e,r[o])&&t.push(n(r[o]));else for(var i in r){var s;!r.hasOwnProperty(i)||a(e,s=(s=r[i])&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function j(t){for(var e=p(t).split("."),r=0;r<e.length;r++)e[r]=h+e[r].replace(new RegExp(h,"g"),h+h)+h;var n=e.join(".");return"string"==typeof t?n:((t=q(t)).text=n,t)}function w(t,e,r,n){for(var o=!1,i=[],s=e.start,a=!0;a;)a="."==e.string.charAt(0),o=o||e.string.charAt(0)==h,s=e.start,i.unshift(function(t){for(var e=(t="."==t.charAt(0)?t.substr(1):t).split(h+h),r=0;r<e.length;r++)e[r]=e[r].replace(new RegExp(h,"g"),"");return e.join(h)}(e.string)),"."==(e=n.getTokenAt(m(t.line,e.start))).string&&(a=!0,e=n.getTokenAt(m(t.line,e.start)));A(r,l=i.join("."),d,function(t){return o?j(t):t}),A(r,l,g,function(t){return o?j(t):t});var l=i.pop(),u=i.join("."),f=!1,c=u;C(u)||(u=U(p=u,n))!==p&&(f=!0);var p=C(u);return(p=p&&p.columns?p.columns:p)&&A(r,l,p,function(t){var e=1==f?c:u;return"string"==typeof t?t=e+"."+t:(t=q(t)).text=e+"."+t.text,o?j(t):t}),s}function U(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),i="",s="",a=[],l={start:m(0,0),end:m(e.lastLine(),e.getLineHandle(e.lastLine()).length)},u=n.indexOf(v);-1!=u;)a.push(r.posFromIndex(u)),u=n.indexOf(v,u+1);a.unshift(m(0,0)),a.push(m(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var f=null,c=e.getCursor(),p=0;p<a.length;p++){if((null==f||0<b(c,f))&&b(c,a[p])<=0){l={start:f,end:a[p]};break}f=a[p]}if(l.start)for(var d=r.getRange(l.start,l.end,!1),p=0;p<d.length;p++)if(!function(t,e){for(var r=t.split(/\s+/),n=0;n<r.length;n++)r[n]&&e(r[n].replace(/[`,;]/g,""))}(d[p],function(t){var e=t.toUpperCase();e===o&&C(i)&&(s=i),e!==x&&(i=t)}),s)break;return s}u.registerHelper("hint","sql",function(t,e){d=function(t){var e={};if(c(t))for(var r=t.length-1;0<=r;r--){var n=t[r];e[p(n).toUpperCase()]=y(p(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=y(o,t[o]);return e}(e&&e.tables);var r=e&&e.defaultTable,n=e&&e.disableKeywords;g=r&&C(r),l=(l=t).doc.modeOption,f=u.resolveMode(l="sql"===l?"text/x-sql":l).keywords,e=(e=t).doc.modeOption,h=u.resolveMode(e="sql"===e?"text/x-sql":e).identifierQuote||"`",(g=(g=r&&!g?U(r,t):g)||[]).columns&&(g=g.columns);var o,i,s,a,l=t.getCursor(),e=[],r=t.getTokenAt(l);return r.end>l.ch&&(r.end=l.ch,r.string=r.string.slice(0,l.ch-r.start)),r.string.match(/^[.`"'\w@][\w$#]*$/g)?(s=r.string,o=r.start,i=r.end):(o=i=l.ch,s=""),"."==s.charAt(0)||s.charAt(0)==h?o=w(l,r,e,t):(a=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t},A(e,s,g,function(t){return a(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),A(e,s,d,function(t){return a(t,"CodeMirror-hint-table")}),n||A(e,s,f,function(t){return a(t.toUpperCase(),"CodeMirror-hint-keyword")})),{list:e,from:m(l.line,o),to:m(l.line,i)}})});