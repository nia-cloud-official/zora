<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.11.0" xml:lang="en-US">
  <compounddef id="xcode__ninja_8py" kind="file" language="Python">
    <compoundname>xcode_ninja.py</compoundname>
    <innernamespace refid="namespacegyp">gyp</innernamespace>
    <innernamespace refid="namespacegyp_1_1xcode__ninja">gyp::xcode_ninja</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacegyp_1_1xcode__ninja" refkind="compound"><highlight class="comment">#<sp/>Copyright<sp/>(c)<sp/>2014<sp/>Google<sp/>Inc.<sp/>All<sp/>rights<sp/>reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Use<sp/>of<sp/>this<sp/>source<sp/>code<sp/>is<sp/>governed<sp/>by<sp/>a<sp/>BSD-style<sp/>license<sp/>that<sp/>can<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">#<sp/>found<sp/>in<sp/>the<sp/>LICENSE<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;Xcode-ninja<sp/>wrapper<sp/>project<sp/>file<sp/>generator.</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">This<sp/>updates<sp/>the<sp/>data<sp/>structures<sp/>passed<sp/>to<sp/>the<sp/>Xcode<sp/>gyp<sp/>generator<sp/>to<sp/>build</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">with<sp/>ninja<sp/>instead.<sp/>The<sp/>Xcode<sp/>project<sp/>itself<sp/>is<sp/>transformed<sp/>into<sp/>a<sp/>list<sp/>of</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral">executable<sp/>targets,<sp/>each<sp/>with<sp/>a<sp/>build<sp/>step<sp/>to<sp/>build<sp/>with<sp/>ninja,<sp/>and<sp/>a<sp/>target</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral">with<sp/>every<sp/>source<sp/>and<sp/>resource<sp/>file.<sp/><sp/>This<sp/>appears<sp/>to<sp/>sidestep<sp/>some<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral">major<sp/>performance<sp/>headaches<sp/>experienced<sp/>using<sp/>complex<sp/>projects<sp/>and<sp/>large<sp/>number</highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral">of<sp/>targets<sp/>within<sp/>Xcode.</highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>errno</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespacegyp_1_1generator_1_1ninja" kindref="compound">gyp.generator.ninja</ref></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>re</highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>xml.sax.saxutils</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="namespacegyp_1_1xcode__ninja_1a50d26b6057f1df48e64b9884213d61c2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacegyp_1_1xcode__ninja_1a50d26b6057f1df48e64b9884213d61c2" kindref="member">_WriteWorkspace</ref>(main_gyp,<sp/>sources_gyp,<sp/>params):</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;<sp/>Create<sp/>a<sp/>workspace<sp/>to<sp/>wrap<sp/>main<sp/>and<sp/>sources<sp/>gyp<sp/>paths.<sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>(build_file_root,<sp/>build_file_ext)<sp/>=<sp/>os.path.splitext(main_gyp)</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/>workspace_path<sp/>=<sp/>build_file_root<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.xcworkspace&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>options<sp/>=<sp/>params[</highlight><highlight class="stringliteral">&quot;options&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>options.generator_output:</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>workspace_path<sp/>=<sp/>os.path.join(options.generator_output,<sp/>workspace_path)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os.makedirs(workspace_path)</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>OSError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>e.errno<sp/>!=<sp/>errno.EEXIST:</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/>output_string<sp/>=<sp/>(</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;?xml<sp/>version=&quot;1.0&quot;<sp/>encoding=&quot;UTF-8&quot;?&gt;\n&apos;</highlight><highlight class="normal"><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&lt;Workspace<sp/>version<sp/>=<sp/>&quot;1.0&quot;&gt;\n&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>gyp_name<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[main_gyp,<sp/>sources_gyp]:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name<sp/>=<sp/>os.path.splitext(os.path.basename(gyp_name))[0]<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.xcodeproj&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name<sp/>=<sp/>xml.sax.saxutils.quoteattr(</highlight><highlight class="stringliteral">&quot;group:&quot;</highlight><highlight class="normal"><sp/>+<sp/>name)</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_string<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>&lt;FileRef<sp/>location<sp/>=<sp/>%s&gt;&lt;/FileRef&gt;\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>name</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>output_string<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;&lt;/Workspace&gt;\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>workspace_file<sp/>=<sp/>os.path.join(workspace_path,<sp/></highlight><highlight class="stringliteral">&quot;contents.xcworkspacedata&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(workspace_file)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>input_file:</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input_string<sp/>=<sp/>input_file.read()</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>input_string<sp/>==<sp/>output_string:</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>OSError:</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Ignore<sp/>errors<sp/>if<sp/>the<sp/>file<sp/>doesn&apos;t<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>open(workspace_file,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>output_file:</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output_file.write(output_string)</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="namespacegyp_1_1xcode__ninja_1ab1430fbd4d4ee7b4f1216f82bdb1b8ea" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacegyp_1_1xcode__ninja_1ab1430fbd4d4ee7b4f1216f82bdb1b8ea" kindref="member">_TargetFromSpec</ref>(old_spec,<sp/>params):</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;<sp/>Create<sp/>fake<sp/>target<sp/>for<sp/>xcode-ninja<sp/>wrapper.<sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Determine<sp/>ninja<sp/>top<sp/>level<sp/>build<sp/>dir<sp/>(e.g.<sp/>/path/to/out).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_toplevel<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>jobs<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>params:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options<sp/>=<sp/>params[</highlight><highlight class="stringliteral">&quot;options&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_toplevel<sp/>=<sp/>os.path.join(</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options.toplevel_dir,<sp/><ref refid="namespacegyp_1_1generator_1_1ninja_1a7c1f50d1b8493a9c6b2f7ce07ef4bb2b" kindref="member">gyp.generator.ninja.ComputeOutputDir</ref>(params)</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jobs<sp/>=<sp/>params.get(</highlight><highlight class="stringliteral">&quot;generator_flags&quot;</highlight><highlight class="normal">,<sp/>{}).get(</highlight><highlight class="stringliteral">&quot;xcode_ninja_jobs&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>target_name<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>product_name<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;product_name&quot;</highlight><highlight class="normal">,<sp/>target_name)</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>product_extension<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;product_extension&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]<sp/>=<sp/>target_name</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;product_name&quot;</highlight><highlight class="normal">]<sp/>=<sp/>product_name</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>product_extension:</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;product_extension&quot;</highlight><highlight class="normal">]<sp/>=<sp/>product_extension</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;default_configuration&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;default_configuration&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">]<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Tell<sp/>Xcode<sp/>to<sp/>look<sp/>in<sp/>|ninja_toplevel|<sp/>for<sp/>build<sp/>products.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>new_xcode_settings<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ninja_toplevel:</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_xcode_settings[</highlight><highlight class="stringliteral">&quot;CONFIGURATION_BUILD_DIR&quot;</highlight><highlight class="normal">]<sp/>=<sp/>(</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;%s/$(CONFIGURATION)$(EFFECTIVE_PLATFORM_NAME)&quot;</highlight><highlight class="normal"><sp/>%<sp/>ninja_toplevel</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>old_spec:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>config<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>old_spec[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>old_xcode_settings<sp/>=<sp/>old_spec[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">][config].get(</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal">,<sp/>{}</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;IPHONEOS_DEPLOYMENT_TARGET&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>old_xcode_settings:</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_xcode_settings[</highlight><highlight class="stringliteral">&quot;CODE_SIGNING_REQUIRED&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;NO&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_xcode_settings[</highlight><highlight class="stringliteral">&quot;IPHONEOS_DEPLOYMENT_TARGET&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_xcode_settings[</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;IPHONEOS_DEPLOYMENT_TARGET&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>key<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&quot;BUNDLE_LOADER&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;TEST_HOST&quot;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>key<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>old_xcode_settings:</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_xcode_settings[key]<sp/>=<sp/>old_xcode_settings[key]</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">][config]<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">][config][</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]<sp/>=<sp/>new_xcode_settings</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;mac_bundle&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;mac_bundle&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;mac_xctest_bundle&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;mac_xctest_bundle&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;ios_app_extension&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;ios_app_extension&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;ios_watchkit_extension&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;ios_watchkit_extension&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;ios_watchkit_app&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec.get(</highlight><highlight class="stringliteral">&quot;ios_watchkit_app&quot;</highlight><highlight class="normal">,<sp/>0)</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_spec[</highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ninja_toplevel:</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;actions&quot;</highlight><highlight class="normal">]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;action_name&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Compile<sp/>and<sp/>copy<sp/>%s<sp/>via<sp/>ninja&quot;</highlight><highlight class="normal"><sp/>%<sp/>target_name,</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;inputs&quot;</highlight><highlight class="normal">:<sp/>[],</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;outputs&quot;</highlight><highlight class="normal">:<sp/>[],</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;action&quot;</highlight><highlight class="normal">:<sp/>[</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;env&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;PATH=%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>os.environ[</highlight><highlight class="stringliteral">&quot;PATH&quot;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;ninja&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;-C&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_xcode_settings[</highlight><highlight class="stringliteral">&quot;CONFIGURATION_BUILD_DIR&quot;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_name,</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>],</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;message&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Compile<sp/>and<sp/>copy<sp/>%s<sp/>via<sp/>ninja&quot;</highlight><highlight class="normal"><sp/>%<sp/>target_name,</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>jobs<sp/>&gt;<sp/>0:</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ninja_target[</highlight><highlight class="stringliteral">&quot;actions&quot;</highlight><highlight class="normal">][0][</highlight><highlight class="stringliteral">&quot;action&quot;</highlight><highlight class="normal">].extend((</highlight><highlight class="stringliteral">&quot;-j&quot;</highlight><highlight class="normal">,<sp/>jobs))</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ninja_target</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="namespacegyp_1_1xcode__ninja_1a68b5ab659fcb19a3231cf41e7bd02cb2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacegyp_1_1xcode__ninja_1a68b5ab659fcb19a3231cf41e7bd02cb2" kindref="member">IsValidTargetForWrapper</ref>(target_extras,<sp/>executable_target_pattern,<sp/>spec):</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Limit<sp/>targets<sp/>for<sp/>Xcode<sp/>wrapper.</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"><sp/><sp/>Xcode<sp/>sometimes<sp/>performs<sp/>poorly<sp/>with<sp/>too<sp/>many<sp/>targets,<sp/>so<sp/>only<sp/>include</highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral"><sp/><sp/>proper<sp/>executable<sp/>targets,<sp/>with<sp/>filters<sp/>to<sp/>customize.</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/>Arguments:</highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>target_extras:<sp/>Regular<sp/>expression<sp/>to<sp/>always<sp/>add,<sp/>matching<sp/>any<sp/>target.</highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>executable_target_pattern:<sp/>Regular<sp/>expression<sp/>limiting<sp/>executable<sp/>targets.</highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>spec:<sp/>Specifications<sp/>for<sp/>target.</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>target_name<sp/>=<sp/>spec.get(</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Always<sp/>include<sp/>targets<sp/>matching<sp/>target_extras.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>target_extras<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>re.search(target_extras,<sp/>target_name):</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Otherwise<sp/>just<sp/>show<sp/>executable<sp/>targets<sp/>and<sp/>xc_tests.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>int(spec.get(</highlight><highlight class="stringliteral">&quot;mac_xctest_bundle&quot;</highlight><highlight class="normal">,<sp/>0))<sp/>!=<sp/>0<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spec.get(</highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;executable&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>spec.get(</highlight><highlight class="stringliteral">&quot;product_extension&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;bundle&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>):</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>there<sp/>is<sp/>a<sp/>filter<sp/>and<sp/>the<sp/>target<sp/>does<sp/>not<sp/>match,<sp/>exclude<sp/>the<sp/>target.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>executable_target_pattern<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>re.search(executable_target_pattern,<sp/>target_name):</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166" refid="namespacegyp_1_1xcode__ninja_1ab6307d8e6c19f93e77b08334eb41ca41" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacegyp_1_1xcode__ninja_1ab6307d8e6c19f93e77b08334eb41ca41" kindref="member">CreateWrapper</ref>(target_list,<sp/>target_dicts,<sp/>data,<sp/>params):</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initialize<sp/>targets<sp/>for<sp/>the<sp/>ninja<sp/>wrapper.</highlight></codeline>
<codeline lineno="168"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="169"><highlight class="stringliteral"><sp/><sp/>This<sp/>sets<sp/>up<sp/>the<sp/>necessary<sp/>variables<sp/>in<sp/>the<sp/>targets<sp/>to<sp/>generate<sp/>Xcode<sp/>projects</highlight></codeline>
<codeline lineno="170"><highlight class="stringliteral"><sp/><sp/>that<sp/>use<sp/>ninja<sp/>as<sp/>an<sp/>external<sp/>builder.</highlight></codeline>
<codeline lineno="171"><highlight class="stringliteral"><sp/><sp/>Arguments:</highlight></codeline>
<codeline lineno="172"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>target_list:<sp/>List<sp/>of<sp/>target<sp/>pairs:<sp/>&apos;base/base.gyp:base&apos;.</highlight></codeline>
<codeline lineno="173"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>target_dicts:<sp/>Dict<sp/>of<sp/>target<sp/>properties<sp/>keyed<sp/>on<sp/>target<sp/>pair.</highlight></codeline>
<codeline lineno="174"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>data:<sp/>Dict<sp/>of<sp/>flattened<sp/>build<sp/>files<sp/>keyed<sp/>on<sp/>gyp<sp/>path.</highlight></codeline>
<codeline lineno="175"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>params:<sp/>Dict<sp/>of<sp/>global<sp/>options<sp/>for<sp/>gyp.</highlight></codeline>
<codeline lineno="176"><highlight class="stringliteral"><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>orig_gyp<sp/>=<sp/>params[</highlight><highlight class="stringliteral">&quot;build_files&quot;</highlight><highlight class="normal">][0]</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>gyp_name,<sp/>gyp_dict<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>data.items():</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>gyp_name<sp/>==<sp/>orig_gyp:</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>depth<sp/>=<sp/>gyp_dict[</highlight><highlight class="stringliteral">&quot;_DEPTH&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Check<sp/>for<sp/>custom<sp/>main<sp/>gyp<sp/>name,<sp/>otherwise<sp/>use<sp/>the<sp/>default<sp/>CHROMIUM_GYP_FILE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>and<sp/>prepend<sp/>.ninja<sp/>before<sp/>the<sp/>.gyp<sp/>extension.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>generator_flags<sp/>=<sp/>params.get(</highlight><highlight class="stringliteral">&quot;generator_flags&quot;</highlight><highlight class="normal">,<sp/>{})</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>main_gyp<sp/>=<sp/>generator_flags.get(</highlight><highlight class="stringliteral">&quot;xcode_ninja_main_gyp&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>main_gyp<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(build_file_root,<sp/>build_file_ext)<sp/>=<sp/>os.path.splitext(orig_gyp)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>main_gyp<sp/>=<sp/>build_file_root<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.ninja&quot;</highlight><highlight class="normal"><sp/>+<sp/>build_file_ext</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Create<sp/>new<sp/>|target_list|,<sp/>|target_dicts|<sp/>and<sp/>|data|<sp/>data<sp/>structures.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>new_target_list<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>new_target_dicts<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Set<sp/>base<sp/>keys<sp/>needed<sp/>for<sp/>|data|.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[main_gyp]<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[main_gyp][</highlight><highlight class="stringliteral">&quot;included_files&quot;</highlight><highlight class="normal">]<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[main_gyp][</highlight><highlight class="stringliteral">&quot;targets&quot;</highlight><highlight class="normal">]<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[main_gyp][</highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal">]<sp/>=<sp/>data[orig_gyp].get(</highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal">,<sp/>{})</highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Normally<sp/>the<sp/>xcode-ninja<sp/>generator<sp/>includes<sp/>only<sp/>valid<sp/>executable<sp/>targets.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>If<sp/>|xcode_ninja_executable_target_pattern|<sp/>is<sp/>set,<sp/>that<sp/>list<sp/>is<sp/>reduced<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>executable<sp/>targets<sp/>that<sp/>match<sp/>the<sp/>pattern.<sp/>(Default<sp/>all)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>executable_target_pattern<sp/>=<sp/>generator_flags.get(</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;xcode_ninja_executable_target_pattern&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>For<sp/>including<sp/>other<sp/>non-executable<sp/>targets,<sp/>add<sp/>the<sp/>matching<sp/>target<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>to<sp/>the<sp/>|xcode_ninja_target_pattern|<sp/>regular<sp/>expression.<sp/>(Default<sp/>none)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>target_extras<sp/>=<sp/>generator_flags.get(</highlight><highlight class="stringliteral">&quot;xcode_ninja_target_pattern&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>old_qualified_target<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>target_list:</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spec<sp/>=<sp/>target_dicts[old_qualified_target]</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/><ref refid="namespacegyp_1_1xcode__ninja_1a68b5ab659fcb19a3231cf41e7bd02cb2" kindref="member">IsValidTargetForWrapper</ref>(target_extras,<sp/>executable_target_pattern,<sp/>spec):</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>to<sp/>new_target_list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_name<sp/>=<sp/>spec.get(</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_target_name<sp/>=<sp/>f</highlight><highlight class="stringliteral">&quot;{main_gyp}:{target_name}#target&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_target_list.append(new_target_name)</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>to<sp/>new_target_dicts.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_target_dicts[new_target_name]<sp/>=<sp/><ref refid="namespacegyp_1_1xcode__ninja_1ab1430fbd4d4ee7b4f1216f82bdb1b8ea" kindref="member">_TargetFromSpec</ref>(spec,<sp/>params)</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>to<sp/>new_data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>old_target<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>data[old_qualified_target.split(</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal">)[0]][</highlight><highlight class="stringliteral">&quot;targets&quot;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>old_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]<sp/>==<sp/>target_name:</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_data_target<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_data_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_data_target[</highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">]<sp/>=<sp/>old_target[</highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_data[main_gyp][</highlight><highlight class="stringliteral">&quot;targets&quot;</highlight><highlight class="normal">].append(new_data_target)</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Create<sp/>sources<sp/>target.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>sources_target_name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;sources_for_indexing&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>sources_target<sp/>=<sp/><ref refid="namespacegyp_1_1xcode__ninja_1ab1430fbd4d4ee7b4f1216f82bdb1b8ea" kindref="member">_TargetFromSpec</ref>(</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">:<sp/>sources_target_name,</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;target&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;default_configuration&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Default&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;mac_bundle&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;0&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;executable&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>},</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Tell<sp/>Xcode<sp/>to<sp/>look<sp/>everywhere<sp/>for<sp/>headers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>sources_target[</highlight><highlight class="stringliteral">&quot;configurations&quot;</highlight><highlight class="normal">]<sp/>=<sp/>{</highlight><highlight class="stringliteral">&quot;Default&quot;</highlight><highlight class="normal">:<sp/>{</highlight><highlight class="stringliteral">&quot;include_dirs&quot;</highlight><highlight class="normal">:<sp/>[depth]}}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Put<sp/>excluded<sp/>files<sp/>into<sp/>the<sp/>sources<sp/>target<sp/>so<sp/>they<sp/>can<sp/>be<sp/>opened<sp/>in<sp/>Xcode.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>skip_excluded_files<sp/>=<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>generator_flags.get(</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;xcode_ninja_list_excluded_files&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>sources<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>target,<sp/>target_dict<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>target_dicts.items():</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base<sp/>=<sp/>os.path.dirname(target)</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files<sp/>=<sp/>target_dict.get(</highlight><highlight class="stringliteral">&quot;sources&quot;</highlight><highlight class="normal">,<sp/>[])<sp/>+<sp/>target_dict.get(</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;mac_bundle_resources&quot;</highlight><highlight class="normal">,<sp/>[]</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>skip_excluded_files:</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files.extend(</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_dict.get(</highlight><highlight class="stringliteral">&quot;sources_excluded&quot;</highlight><highlight class="normal">,<sp/>[])</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>target_dict.get(</highlight><highlight class="stringliteral">&quot;mac_bundle_resources_excluded&quot;</highlight><highlight class="normal">,<sp/>[])</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>action<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>target_dict.get(</highlight><highlight class="stringliteral">&quot;actions&quot;</highlight><highlight class="normal">,<sp/>[]):</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files.extend(action.get(</highlight><highlight class="stringliteral">&quot;inputs&quot;</highlight><highlight class="normal">,<sp/>[]))</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>skip_excluded_files:</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files.extend(action.get(</highlight><highlight class="stringliteral">&quot;inputs_excluded&quot;</highlight><highlight class="normal">,<sp/>[]))</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>files<sp/>starting<sp/>with<sp/>$.<sp/>These<sp/>are<sp/>mostly<sp/>intermediate<sp/>files<sp/>for<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>build<sp/>system.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files<sp/>=<sp/>[file<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>file<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>files<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>file.startswith(</highlight><highlight class="stringliteral">&quot;$&quot;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Make<sp/>sources<sp/>relative<sp/>to<sp/>root<sp/>build<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>relative_path<sp/>=<sp/>os.path.dirname(main_gyp)</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sources<sp/>+=<sp/>[</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os.path.relpath(os.path.join(base,<sp/>file),<sp/>relative_path)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>file<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>files</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>sources_target[</highlight><highlight class="stringliteral">&quot;sources&quot;</highlight><highlight class="normal">]<sp/>=<sp/>sorted(set(sources))</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Put<sp/>sources_to_index<sp/>in<sp/>it&apos;s<sp/>own<sp/>gyp.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>sources_gyp<sp/>=<sp/>os.path.join(os.path.dirname(main_gyp),<sp/>sources_target_name<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.gyp&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>fully_qualified_target_name<sp/>=<sp/>f</highlight><highlight class="stringliteral">&quot;{sources_gyp}:{sources_target_name}#target&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>to<sp/>new_target_list,<sp/>new_target_dicts<sp/>and<sp/>new_data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>new_target_list.append(fully_qualified_target_name)</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>new_target_dicts[fully_qualified_target_name]<sp/>=<sp/>sources_target</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data_target<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]<sp/>=<sp/>sources_target[</highlight><highlight class="stringliteral">&quot;target_name&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data_target[</highlight><highlight class="stringliteral">&quot;_DEPTH&quot;</highlight><highlight class="normal">]<sp/>=<sp/>depth</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data_target[</highlight><highlight class="stringliteral">&quot;toolset&quot;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;target&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[sources_gyp]<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[sources_gyp][</highlight><highlight class="stringliteral">&quot;targets&quot;</highlight><highlight class="normal">]<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[sources_gyp][</highlight><highlight class="stringliteral">&quot;included_files&quot;</highlight><highlight class="normal">]<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[sources_gyp][</highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal">]<sp/>=<sp/>data[orig_gyp].get(</highlight><highlight class="stringliteral">&quot;xcode_settings&quot;</highlight><highlight class="normal">,<sp/>{})</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>new_data[sources_gyp][</highlight><highlight class="stringliteral">&quot;targets&quot;</highlight><highlight class="normal">].append(new_data_target)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Write<sp/>workspace<sp/>to<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacegyp_1_1xcode__ninja_1a50d26b6057f1df48e64b9884213d61c2" kindref="member">_WriteWorkspace</ref>(main_gyp,<sp/>sources_gyp,<sp/>params)</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(new_target_list,<sp/>new_target_dicts,<sp/>new_data)</highlight></codeline>
    </programlisting>
    <location file="backend/node_modules/node-gyp/gyp/pylib/gyp/xcode_ninja.py"/>
  </compounddef>
</doxygen>
